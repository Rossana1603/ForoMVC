
@using System.Activities.Statements
@using System.Web.UI.WebControls
@using System.Web.Script.Serialization;

@model Forum.Web.Models.TopicDetailViewModel

@{
    ViewBag.Title = "TopicDetail";
}

<div>
    <br/>
    <div class="panel panel-primary" style="width: 815px">
        <table style="width: 800px">
            <tr>
                <td></td>
                <td><h4>@Model.Topic.Title</h4></td>

            </tr>
            <tr>
                <td style="width: 35px"></td>                
                <td style="padding-bottom:10px;">@Html.Raw(Model.Topic.Content)</td>
            </tr>
            <tr>
                <td></td>
                <td>
                    Creado en : @Model.Topic.CreateDate
                </td>
            </tr>
            <tr>
                <td></td>
            </tr>
        </table>
    </div>
    <br/>
    @foreach (var item in Model.Posts)
    {
        <div class="panel panel-primary" style="width: 750px">
            <table style="width: 600px">
                <tr>
                    <td></td>
                    <td style="width: 115px">
                    @if (item.AvatarFileName == string.Empty)
                    {
                        <img src="~/Images/default-avatar.dmbNkD5D-u45r44go_cf0g.png" class="img-responsive" alt="Responsive image" style="width: 100px">
                    }
                    else
                    {
                        <img src="~/Content/Images/@(item.AvatarFileName)" class="img-responsive" alt="Responsive image" style="width: 100px">
                    }
                    </td>
                    <td>                        
                        @Html.Raw(item.Content)
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Author.UserName)
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td style="text-align: right">
                        @if(item.IsTopicCreator)
                        {
                            @Html.ActionLink("Edit", "EditPost", "Post", new { postId = item.Id, page = Model.Posts.PageNumber }, null)
                            <span> | </span>
                            @Html.ActionLink("Delete", "DeletePost", "Post", new { postId = item.Id, page = Model.Posts.PageNumber, topicJson = new JavaScriptSerializer().Serialize(Model.Topic) }, null)
                        } 
                        | @Html.ActionLink("Like", "like", new { })
                    </td>
                </tr>
            </table>
        </div>
    }
    <div>
        @if (Model.Posts.PageCount>0)
        {
            @:Page 
            @(Model.Posts.PageCount < Model.Posts.PageNumber ? 0 : Model.Posts.PageNumber)
            @:of 
            @Model.Posts.PageCount

        if (Model.Posts.HasPreviousPage)
        {
            @Html.ActionLink("<<", "TopicDetail", new { Page = 1, topicJson = new JavaScriptSerializer().Serialize(Model.Topic) })
            @Html.Raw(" ")
            @Html.ActionLink("<Prve", "TopicDetail", new { Page = Model.Posts.PageNumber - 1, topicJson = new JavaScriptSerializer().Serialize(Model.Topic) })
        }
        else
        {
            @:<<
            @Html.Raw(" ")
            @:< Prev
        }

        @Html.Raw(" ")
        
        if (Model.Posts.HasNextPage)
        {
            @Html.ActionLink("Next >", "TopicDetail", new { Page = Model.Posts.PageNumber + 1, topicJson = new JavaScriptSerializer().Serialize(Model.Topic) })
            @Html.Raw(" ")
            @Html.ActionLink(">>", "TopicDetail", new { Page = Model.Posts.PageCount, topicJson = new JavaScriptSerializer().Serialize(Model.Topic) })
        }
        else
        {
            @:Next>
            @Html.Raw(" ")
            @:>>
         }
        }
    </div>

</div>
<p>        
    @Html.ActionLink("New post", "AddPost", "Post", new { id = Model.Topic.Id }, null)
</p>